# ElixirDTLS

[![Hex.pm](https://img.shields.io/hexpm/v/elixir_dtls.svg)](https://hex.pm/packages/elixir_dtls)
[![CircleCI](https://circleci.com/gh/membraneframework/elixir_dtls.svg?style=svg)](https://circleci.com/gh/membraneframework/elixir_dtls)

Elixir wrapper over [OpenSSL] for performing DTLS handshake (including DTLS-SRTP one).

ElixirDTLS allows user to perform DTLS handshake (including DTLS-SRTP one) without requiring
any socket. Instead, it exchanges DTLS packets with its parent which is responsible for
transporting them to the peer. Thanks to this DTLS handshake can be performed on the third
party socket e.g. one used to establish connection via ICE protocol.

## Installation

The package can be installed by adding `elixir_dtls` to your list of dependencies in `mix.exs`:

```elixir
def deps do
  [
    {:elixir_dtls, "~> 0.1.0"}
  ]
end
```

## Usage
```elixir
# Init ExDTLS on both peers with:
{:ok, dtls} = ExDTLS.start_link(self(), client_mode, dtls_srtp)
```

```elixir
# On a peer running in a client mode start performing DTLS handshake
:ok = ExDTLS.do_handshake(dtls)
```

```elixir
# On both peers receive generated by ExDTLS module packets (e.g. using `handle_info/2` callback
# if your parent works as GenServer) and transport them to the peer
@impl true
def handle_info({:packets, data}, %State{peer_socket: peer_socket} = state) do
  :socket.send(peer_socket, data)
  {:noreply, state}
end
```

```elixir
# In a separate process wait for peer DTLS packets and send them to ExDTLS
{:ok, data} = :socket.recv(peer_socket)
:ok = ExDTLS.feed(dtls, data)
peer_to_dtls(dtls, peer_socket)
```

After some back and forth DTLS handshake should be finished successfully. This will be
signalised with message `{:handshake_finished, keying_material}`.

For more complete examples please refer to [membrane_ice_plugin] where we use `elixir_dtls`
or to our integration tests and `TestPeer` module.

## Copyright and License

Copyright 2020, [Software Mansion](https://swmansion.com/?utm_source=git&utm_medium=readme&utm_campaign=elixir_dtls)

[![Software Mansion](https://logo.swmansion.com/logo?color=white&variant=desktop&width=200&tag=membrane-github)](https://swmansion.com/?utm_source=git&utm_medium=readme&utm_campaign=elixir_dtls)

Licensed under the [Apache License, Version 2.0](LICENSE)

[OpenSSL]: https://www.openssl.org/
[membrane_ice_plugin]: https://github.com/membraneframework/membrane_ice_plugin
